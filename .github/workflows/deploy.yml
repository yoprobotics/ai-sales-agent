name: Deploy\n\non:\n  push:\n    tags:\n      - 'v*'\n  workflow_dispatch:\n    inputs:\n      environment:\n        description: 'Deployment environment'\n        required: true\n        default: 'production'\n        type: choice\n        options:\n          - production\n          - staging\n\njobs:\n  deploy:\n    name: Deploy to Vercel\n    runs-on: ubuntu-latest\n    environment: ${{ github.event.inputs.environment || 'production' }}\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v4\n        with:\n          fetch-depth: 0\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: 18\n          cache: npm\n\n      - name: Install dependencies\n        run: npm ci\n\n      - name: Run tests\n        run: npm run test\n        env:\n          CI: true\n\n      - name: Build\n        run: npm run build\n        env:\n          DATABASE_URL: ${{ secrets.DATABASE_URL }}\n          JWT_SECRET: ${{ secrets.JWT_SECRET }}\n          JWT_REFRESH_SECRET: ${{ secrets.JWT_REFRESH_SECRET }}\n          STRIPE_SECRET_KEY: ${{ secrets.STRIPE_SECRET_KEY }}\n          STRIPE_PUBLISHABLE_KEY: ${{ secrets.STRIPE_PUBLISHABLE_KEY }}\n          STRIPE_WEBHOOK_SECRET: ${{ secrets.STRIPE_WEBHOOK_SECRET }}\n          SENDGRID_API_KEY: ${{ secrets.SENDGRID_API_KEY }}\n          SENDGRID_FROM_EMAIL: ${{ secrets.SENDGRID_FROM_EMAIL }}\n          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}\n          S3_ACCESS_KEY_ID: ${{ secrets.S3_ACCESS_KEY_ID }}\n          S3_SECRET_ACCESS_KEY: ${{ secrets.S3_SECRET_ACCESS_KEY }}\n          S3_BUCKET: ${{ secrets.S3_BUCKET }}\n          S3_REGION: ${{ secrets.S3_REGION }}\n          APP_BASE_URL: ${{ secrets.APP_BASE_URL }}\n          ENCRYPTION_KEY: ${{ secrets.ENCRYPTION_KEY }}\n\n      - name: Deploy to Vercel\n        uses: amondnet/vercel-action@v25\n        with:\n          vercel-token: ${{ secrets.VERCEL_TOKEN }}\n          github-token: ${{ secrets.GITHUB_TOKEN }}\n          vercel-args: '--prod'\n          vercel-org-id: ${{ secrets.ORG_ID }}\n          vercel-project-id: ${{ secrets.PROJECT_ID }}\n          working-directory: ./\n\n      - name: Update deployment status\n        if: always()\n        run: |\n          if [ \"${{ job.status }}\" == \"success\" ]; then\n            echo \"‚úÖ Deployment successful!\"\n            echo \"üöÄ Application deployed to production\"\n          else\n            echo \"‚ùå Deployment failed!\"\n            echo \"Please check the logs for more information\"\n            exit 1\n          fi\n\n  notify:\n    name: Notify Team\n    runs-on: ubuntu-latest\n    needs: [deploy]\n    if: always()\n    steps:\n      - name: Notify success\n        if: needs.deploy.result == 'success'\n        run: |\n          echo \"üéâ AI Sales Agent deployed successfully!\"\n          echo \"Version: ${{ github.ref_name }}\"\n          echo \"Environment: ${{ github.event.inputs.environment || 'production' }}\"\n\n      - name: Notify failure\n        if: needs.deploy.result == 'failure'\n        run: |\n          echo \"üí• Deployment failed for AI Sales Agent\"\n          echo \"Version: ${{ github.ref_name }}\"\n          echo \"Please check the deployment logs\"\n
# Architecture Guide\n\nThis document provides a comprehensive overview of the AI Sales Agent application architecture.\n\n## System Overview\n\nAI Sales Agent is a B2B prospecting SaaS platform built with a modern, scalable architecture designed for high performance and maintainability.\n\n### Core Principles\n\n- **Modularity**: Each package has a single responsibility\n- **Type Safety**: TypeScript throughout with strict validation\n- **Security First**: GDPR/PIPEDA/CCPA compliant by design\n- **Performance**: Optimized for speed and scalability\n- **Internationalization**: Full French/English support\n\n## Architecture Overview\n\n```\n┌─────────────────────────────────────────────────────────────────┐\n│                        Frontend (Next.js)                      │\n├─────────────────────────────────────────────────────────────────┤\n│                         API Layer                              │\n├─────────────────────────────────────────────────────────────────┤\n│    Core Packages (Modular Business Logic)                      │\n│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐              │\n│  │ Ingest  │ │ Qualify │ │AI-Assist│ │Sequences│              │\n│  └─────────┘ └─────────┘ └─────────┘ └─────────┘              │\n│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐              │\n│  │   CRM   │ │ Reports │ │  Core   │ │  i18n   │              │\n│  └─────────┘ └─────────┘ └─────────┘ └─────────┘              │\n├─────────────────────────────────────────────────────────────────┤\n│                     External Services                          │\n│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐              │\n│  │PostgreSQL│ │ Stripe  │ │SendGrid │ │ OpenAI  │              │\n│  └─────────┘ └─────────┘ └─────────┘ └─────────┘              │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n## Monorepo Structure\n\n### Apps\n\n- **`apps/web`**: Next.js 14 frontend application\n  - App Router with TypeScript\n  - Tailwind CSS for styling\n  - React Query for state management\n  - Internationalization support\n\n- **`apps/api`**: API routes and backend logic\n  - RESTful API endpoints\n  - Authentication middleware\n  - Rate limiting and security\n  - Database operations\n\n### Packages\n\n#### Core (`packages/core`)\nFoundational types, schemas, and utilities used across the application.\n\n**Exports:**\n- TypeScript interfaces and types\n- Zod validation schemas\n- Utility functions\n- Application constants\n- Custom error classes\n\n#### Ingest (`packages/ingest`)\nData ingestion and prospect parsing from various sources.\n\n**Features:**\n- CSV file parsing and validation\n- URL scraping for prospect data\n- Data normalization and cleaning\n- Duplicate detection\n- Batch processing\n\n#### Qualify (`packages/qualify`)\nAI-powered prospect qualification system.\n\n**Features:**\n- BANT scoring (Budget, Authority, Need, Timing)\n- Signal detection and analysis\n- Transparent scoring explanations\n- Confidence levels\n- Multi-language support\n\n#### AI-Assist (`packages/ai-assist`)\nAI-powered messaging and insights generation.\n\n**Features:**\n- Personalized email generation\n- Message templates in FR/EN\n- AI insights and recommendations\n- Content optimization\n- Tone and style adaptation\n\n#### Sequences (`packages/sequences`)\nEmail sequence orchestration and automation.\n\n**Features:**\n- Multi-step sequence creation\n- Conditional logic and branching\n- Scheduling and timing\n- Performance tracking\n- A/B testing support\n\n#### CRM (`packages/crm`)\nCustomer relationship management and pipeline.\n\n**Features:**\n- Pipeline stage management\n- Activity tracking\n- Task automation\n- Reminder system\n- Reporting and analytics\n\n#### Reports (`packages/reports`)\nAnalytics, KPIs, and business intelligence.\n\n**Features:**\n- Performance dashboards\n- Custom report generation\n- Data visualization\n- Predictive analytics\n- Export capabilities\n\n#### i18n (`packages/i18n`)\nInternationalization and localization.\n\n**Features:**\n- French/English translations\n- Regional compliance (GDPR/PIPEDA/CCPA)\n- Currency and date formatting\n- Timezone handling\n- Cultural adaptations\n\n## Data Architecture\n\n### Database Schema\n\n```sql\n-- Core entities\nusers\nicps (Ideal Customer Profiles)\nprospects\ncompanies\n\n-- Messaging & Sequences\nemail_sequences\nsequence_steps\ncampaigns\nmessages\n\n-- CRM & Activities\nactivities\nnotes\ntasks\n\n-- Analytics & Insights\nai_insights\nreports\nevents\n\n-- Subscriptions & Billing\nsubscriptions\npayments\nusage_metrics\n```\n\n### Data Flow\n\n1. **Prospect Ingestion**\n   - User uploads CSV or provides URLs\n   - Data parsed and normalized\n   - Prospects created with company info\n\n2. **AI Qualification**\n   - Prospect data analyzed\n   - BANT score calculated\n   - Explanations generated\n   - Results stored\n\n3. **Sequence Execution**\n   - Qualified prospects added to sequences\n   - Messages generated and scheduled\n   - Delivery status tracked\n   - Responses monitored\n\n4. **Analytics & Insights**\n   - Performance metrics calculated\n   - AI insights generated\n   - Reports created\n   - Recommendations provided\n\n## Security Architecture\n\n### Authentication & Authorization\n\n- **JWT Tokens**: Short-lived access tokens (15 minutes)\n- **Refresh Tokens**: Long-lived refresh tokens (7 days) \n- **Role-Based Access Control**: CLIENT, ADMIN, TEAM_MEMBER, TEAM_OWNER\n- **Session Management**: Secure cookie storage\n- **Password Security**: Argon2id hashing\n\n### Data Protection\n\n- **Encryption at Rest**: Sensitive data encrypted in database\n- **Encryption in Transit**: HTTPS/TLS everywhere\n- **Data Isolation**: Multi-tenant architecture\n- **Access Logging**: Comprehensive audit trails\n- **Rate Limiting**: API and authentication protection\n\n### Compliance\n\n- **GDPR**: Right to be forgotten, data portability\n- **PIPEDA**: Canadian privacy requirements\n- **CCPA**: California consumer privacy\n- **Data Residency**: EU/US/CA region selection\n- **Retention Policies**: Automated data cleanup\n\n## Deployment Architecture\n\n### Vercel Deployment\n\n- **Frontend**: Next.js app deployed to Vercel Edge Network\n- **API Routes**: Serverless functions for backend logic\n- **Static Assets**: CDN-optimized delivery\n- **Environment Variables**: Secure configuration management\n\n### External Services\n\n- **Database**: PostgreSQL (Neon/Supabase)\n- **Storage**: S3-compatible object storage\n- **Email**: SendGrid for transactional emails\n- **Payments**: Stripe for subscriptions\n- **AI**: OpenAI for language processing\n- **Monitoring**: OpenTelemetry integration\n\n### CI/CD Pipeline\n\n1. **Code Push**: Developer pushes to GitHub\n2. **CI Checks**: Lint, typecheck, tests run\n3. **Build**: Applications built and tested\n4. **Deploy**: Automatic deployment to Vercel\n5. **Monitoring**: Health checks and alerts\n\n## Performance Considerations\n\n### Frontend Optimization\n\n- **Code Splitting**: Lazy loading of components\n- **Image Optimization**: Next.js Image component\n- **Caching**: React Query for data caching\n- **Bundle Analysis**: Webpack bundle optimization\n- **CDN**: Global content delivery\n\n### Backend Optimization\n\n- **Database Indexing**: Optimized queries\n- **Connection Pooling**: Efficient database connections\n- **Caching Strategy**: Redis for frequently accessed data\n- **Rate Limiting**: Protection against abuse\n- **Monitoring**: Performance metrics and alerting\n\n### Scalability\n\n- **Horizontal Scaling**: Serverless function auto-scaling\n- **Database Scaling**: Read replicas and partitioning\n- **Queue Processing**: Background job processing\n- **Load Balancing**: Automatic traffic distribution\n- **Resource Monitoring**: Auto-scaling based on metrics\n\n## Development Guidelines\n\n### Code Standards\n\n- **TypeScript**: Strict mode enabled\n- **ESLint**: Comprehensive linting rules\n- **Prettier**: Consistent code formatting\n- **Testing**: Unit and integration tests\n- **Documentation**: TSDoc for functions\n\n### Package Development\n\n- **Single Responsibility**: Each package has one purpose\n- **Interface Design**: Clean, typed APIs\n- **Error Handling**: Comprehensive error management\n- **Testing**: Package-level test suites\n- **Documentation**: README and API docs\n\n### Git Workflow\n\n- **Feature Branches**: Isolated development\n- **Pull Requests**: Code review process\n- **Conventional Commits**: Standardized commit messages\n- **Semantic Versioning**: Version management\n- **Release Tags**: Automated deployments\n\n## Monitoring & Observability\n\n### Logging\n\n- **Structured Logging**: JSON format\n- **Log Levels**: DEBUG, INFO, WARN, ERROR\n- **Correlation IDs**: Request tracing\n- **Retention**: 90-day log retention\n- **Search**: Log aggregation and search\n\n### Metrics\n\n- **Application Metrics**: Performance indicators\n- **Business Metrics**: KPIs and conversions\n- **Infrastructure Metrics**: System health\n- **Custom Metrics**: Domain-specific tracking\n- **Alerting**: Automated incident response\n\n### Error Tracking\n\n- **Error Reporting**: Automatic error capture\n- **Stack Traces**: Detailed error information\n- **User Context**: Error impact assessment\n- **Alert Integration**: Instant notifications\n- **Resolution Tracking**: Error lifecycle management\n\n## Future Considerations\n\n### Planned Enhancements\n\n- **Team Collaboration**: Multi-user workspaces\n- **CRM Integrations**: HubSpot, Salesforce connectors\n- **Mobile Application**: Native iOS/Android apps\n- **Advanced AI**: GPT-4 integration and fine-tuning\n- **Real-time Features**: WebSocket connections\n\n### Technical Debt\n\n- **Database Migrations**: Schema evolution strategy\n- **Legacy Code**: Gradual refactoring plan\n- **Performance Optimization**: Continuous improvement\n- **Security Updates**: Regular dependency updates\n- **Documentation**: Ongoing documentation maintenance\n